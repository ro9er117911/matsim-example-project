# GTFS æ•°æ®åˆå¹¶åˆ†ææŠ¥å‘Š

> **ğŸ“ Note**: This is a summary version. For the most detailed and up-to-date analysis, see:
> **[working_journal/2025-11-17-GTFS-Merge-Analysis.md](working_journal/2025-11-17-GTFS-Merge-Analysis.md)**

**æ—¥æœŸ**: 2025-11-17
**ä»»åŠ¡**: åˆå¹¶ gtfs_tw_v5 ä¸ tp_metro_gtfs
**çŠ¶æ€**: âš ï¸ **å‘ç°å…³é”®é—®é¢˜ - éœ€è¦è°ƒæ•´ç­–ç•¥**

---

## ğŸ“Š æ•°æ®é›†æ¦‚è§ˆ

### 1. gtfs_tw_v5ï¼ˆå…¨å°æ¹¾äº¤é€šæ•°æ®ï¼‰

**æ–‡ä»¶æ¸…å•**:
```
âœ… agency.txt          (393 agencies - èˆªç©ºã€å…¬äº¤ã€é“è·¯ç­‰)
âœ… calendar.txt        (261,385 æœåŠ¡æ—¥å†)
âœ… calendar_dates.txt  (56,884 æ—¥æœŸä¾‹å¤–)
âœ… routes.txt          (9,663 è·¯çº¿)
âœ… stops.txt           (154,477 ç«™ç‚¹)
âœ… stops_epsg3826.txt  (154,477 ç«™ç‚¹ - TWD97åæ ‡)
âœ… trips.txt           (326,645 è¡Œç¨‹)
âŒ stop_times.txt      **ã€ç¼ºå¤± - è‡´å‘½é—®é¢˜ã€‘**
```

**è·¯çº¿ç±»å‹åˆ†å¸ƒ**:
- `route_type=1` (åœ°é“/æ·è¿): 47 æ¡
- `route_type=2` (é“è·¯): 1,234 æ¡
- `route_type=3` (å…¬äº¤è½¦): 8,329 æ¡
- `route_type=4` (æ¸¡è½®): 49 æ¡
- `route_type=6` (ç¼†è½¦/èˆªç©º): 4 æ¡

**å…³é”®é—®é¢˜**:
ğŸ”´ **ç¼ºå°‘ stop_times.txt** - è¿™æ˜¯ GTFS è§„èŒƒä¸­çš„**å¿…éœ€æ–‡ä»¶**ï¼ŒåŒ…å«æ¯ä¸ªè¡Œç¨‹åœ¨æ¯ä¸ªç«™ç‚¹çš„åˆ°è¾¾/ç¦»å¼€æ—¶é—´ã€‚æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæ•°æ®é›†**æ— æ³•ç”¨äº MATSim æ¨¡æ‹Ÿ**ã€‚

### 2. tp_metro_gtfsï¼ˆå°åŒ—æ·è¿å®Œæ•´æ•°æ®ï¼‰

**æ–‡ä»¶æ¸…å•**:
```
âœ… agency.txt          (1 agency - TRTC å°åŒ—æ·è¿)
âœ… calendar.txt        (12 æœåŠ¡æ—¥å†)
âœ… calendar_dates.txt  (80 æ—¥æœŸä¾‹å¤–)
âœ… frequencies.txt     (16 ç­æ¬¡é¢‘ç‡å®šä¹‰)
âœ… routes.txt          (7 åœ°é“çº¿è·¯)
âœ… stop_times.txt      (100,015 ç«™ç‚¹æ—¶åˆ») âœ“
âœ… stops.txt           (722 ç«™ç‚¹)
âœ… stops_epsg3826.txt  (722 ç«™ç‚¹ - TWD97åæ ‡)
âœ… transitions.txt     (6,723 ç¿»è¯‘æ¡ç›® - å¤šè¯­è¨€æ”¯æŒ)
âœ… trips.txt           (5,990 è¡Œç¨‹)
```

**è·¯çº¿æ¸…å•**:
- Blue (æ¿å—çº¿)
- Red (æ·¡æ°´ä¿¡ä¹‰çº¿)
- Green (æ¾å±±æ–°åº—çº¿)
- Orange (ä¸­å’Œæ–°èŠ¦çº¿)
- Brown (æ–‡æ¹–çº¿)
- ç­‰...

**æ•°æ®å®Œæ•´æ€§**: âœ… **å®Œå…¨ç¬¦åˆ GTFS è§„èŒƒï¼Œå¯ç›´æ¥ä½¿ç”¨**

---

## ğŸ” å…¼å®¹æ€§åˆ†æ

### Agency ID å†²çªæ£€æŸ¥
- âœ… **æ— å†²çª**: gtfs_tw_v5 ä½¿ç”¨ `AirLine_XX`, `Bus_XX` ç­‰å‰ç¼€
- âœ… **æ— å†²çª**: tp_metro_gtfs ä½¿ç”¨ `TRTC`

### åæ ‡ç³»ç»Ÿ
- âœ… **ä¸€è‡´**: ä¸¤ä¸ªæ•°æ®é›†éƒ½ä½¿ç”¨ **EPSG:3826 (TWD97/TM2)**
- âœ… **æ ¼å¼**: éƒ½åŒ…å« `stop_x_EPSG3826` å’Œ `stop_y_EPSG3826` å­—æ®µ

### Stop ID å‘½åè§„åˆ™
- **gtfs_tw_v5**: `AirLine_CMJ`, `Bus_XXXX` ç­‰ï¼ˆæŒ‰è¿è¥å•†åˆ†ç±»ï¼‰
- **tp_metro_gtfs**: `BL01_UP`, `BL01_DN`, `076` ç­‰ï¼ˆæŒ‰çº¿è·¯å’Œæ–¹å‘åˆ†ç±»ï¼‰
- âœ… **æ— å†²çª**: å‘½åæ¨¡å¼å®Œå…¨ä¸åŒ

---

## âŒ å…³é”®éšœç¢

### é—®é¢˜ 1: gtfs_tw_v5 ç¼ºå°‘ stop_times.txt

**å½±å“**:
- æ— æ³•çŸ¥é“è½¦è¾†ä½•æ—¶åˆ°è¾¾æ¯ä¸ªç«™ç‚¹
- æ— æ³•ç”Ÿæˆ MATSim çš„ `transitSchedule.xml`
- æ— æ³•è®¡ç®—è¡Œç¨‹æ—¶é—´å’Œç­æ¬¡é—´éš”
- **æ•°æ®é›†æ— æ³•ç”¨äºä»»ä½•åŸºäºæ—¶åˆ»è¡¨çš„ä»¿çœŸ**

**æ ¹æœ¬åŸå› **ï¼ˆæ¨æµ‹ï¼‰:
- å¯èƒ½æ˜¯æ•°æ®å¯¼å‡ºä¸å®Œæ•´
- å¯èƒ½ä½¿ç”¨ `frequencies.txt` æ›¿ä»£ï¼ˆä½† gtfs_tw_v5 ä¹Ÿæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼‰
- å¯èƒ½æ˜¯åŸå§‹æ•°æ®æºå°±ä¸åŒ…å«æ—¶åˆ»è¡¨ä¿¡æ¯

### é—®é¢˜ 2: transitions.txt ä¸æ˜¯è½¬ä¹˜ä¿¡æ¯

**å‘ç°**:
```
table_name,field_name,language,translation,record_id,record_sub_id,field_value
agency,agency_name,en,Taipei Rapid Transit Corporation,TRTC,,
routes,route_short_name,en,Bannan Line,Blue,,
```

è¿™æ˜¯ **translations.txt** çš„å†…å®¹ï¼ˆå¤šè¯­è¨€ç¿»è¯‘ï¼‰ï¼Œä¸æ˜¯ **transfers.txt**ï¼ˆè½¬ä¹˜ä¿¡æ¯ï¼‰ã€‚

**å½±å“**:
- æ— æ³•ç›´æ¥ä½¿ç”¨ç°æœ‰æ–‡ä»¶å»ºç«‹è½¬ä¹˜å…³ç³»
- éœ€è¦ä»é›¶å¼€å§‹è®¡ç®—ç«™ç‚¹é—´çš„è½¬ä¹˜è·ç¦»

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆä¸å»ºè®®

### é€‰é¡¹ 1: ğŸ”´ **æ”¾å¼ƒåˆå¹¶ gtfs_tw_v5**ï¼ˆæ¨èï¼‰

**ç†ç”±**:
- gtfs_tw_v5 **ç¼ºå°‘æ ¸å¿ƒæ—¶åˆ»è¡¨æ•°æ®**ï¼Œæ— æ³•ç”¨äº MATSim
- å³ä½¿åˆå¹¶ï¼Œä¹Ÿæ— æ³•ç”Ÿæˆæœ‰æ•ˆçš„ `transitSchedule.xml`
- æ•°æ®è´¨é‡ä¸ç¬¦åˆé¡¹ç›®éœ€æ±‚

**æ›¿ä»£æ–¹æ¡ˆ**:
- **ä»…ä½¿ç”¨ tp_metro_gtfs** è¿›è¡Œå°åŒ—æ·è¿æ¨¡æ‹Ÿï¼ˆæ•°æ®å®Œæ•´ä¸”å¯é ï¼‰
- å¦‚éœ€å…¬äº¤æ•°æ®ï¼Œå¯»æ‰¾**å®Œæ•´çš„ GTFS æ•°æ®æº**ï¼ˆä¾‹å¦‚ï¼šæ”¿åºœå¼€æ”¾æ•°æ®å¹³å°ï¼‰

### é€‰é¡¹ 2: ğŸŸ¡ **ä»å…¶ä»–æ¥æºè·å–å®Œæ•´ GTFS**

**å°æ¹¾å…¬å…±è¿è¾“ GTFS æ•°æ®æº**:
1. **äº¤é€šéƒ¨ PTX å¹³å°**: https://ptx.transportdata.tw/
   - æä¾›å…¨å°æ¹¾å…¬äº¤ã€é“è·¯ã€æ·è¿ GTFS æ•°æ®
   - æ•°æ®å®Œæ•´ä¸”å®šæœŸæ›´æ–°
   - éœ€è¦ç”³è¯· API å¯†é’¥

2. **å„å¿å¸‚æ”¿åºœå¼€æ”¾æ•°æ®å¹³å°**:
   - å°åŒ—å¸‚: https://data.taipei/
   - æ–°åŒ—å¸‚: https://data.ntpc.gov.tw/
   - é«˜é›„å¸‚: https://data.kcg.gov.tw/

3. **OpenStreetMap ç›¸å…³é¡¹ç›®**:
   - Transitland: https://www.transit.land/

### é€‰é¡¹ 3: ğŸŸ¢ **ä»…ä½¿ç”¨å°åŒ—æ·è¿æ•°æ®**ï¼ˆç«‹å³å¯è¡Œï¼‰

**ä¼˜åŠ¿**:
- âœ… æ•°æ®å®Œæ•´ä¸”é«˜è´¨é‡
- âœ… å·²æœ‰ 100,015 æ¡ stop_times è®°å½•
- âœ… åŒ…å« frequencies.txtï¼ˆç­æ¬¡é¢‘ç‡ï¼‰
- âœ… é€‚åˆæµ‹è¯•å’ŒåŸå‹å¼€å‘

**å»ºè®®æ“ä½œ**:
1. ç›´æ¥ä½¿ç”¨ `tp_metro_gtfs` æˆ– `tp_metro_gtfs_small`
2. ä½¿ç”¨ç°æœ‰çš„ GtfsToMatsim å·¥å…·è½¬æ¢
3. åç»­å¦‚éœ€å…¬äº¤æ•°æ®ï¼Œå†ä» PTX å¹³å°è·å–

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚è®°å½•

### GTFS å¿…éœ€æ–‡ä»¶æ¸…å•ï¼ˆæ ¹æ® GTFS Referenceï¼‰

**æ ¸å¿ƒå¿…éœ€æ–‡ä»¶**:
- âœ… `agency.txt` - è¿è¥å•†ä¿¡æ¯
- âœ… `stops.txt` - ç«™ç‚¹ä½ç½®
- âœ… `routes.txt` - è·¯çº¿å®šä¹‰
- âœ… `trips.txt` - è¡Œç¨‹å®šä¹‰
- âœ… `stop_times.txt` - **æ—¶åˆ»è¡¨** â† gtfs_tw_v5 ç¼ºå¤±
- âœ… `calendar.txt` æˆ– `calendar_dates.txt` - æœåŠ¡æ—¥å†

**å¯é€‰æ–‡ä»¶**:
- `frequencies.txt` - ç­æ¬¡é¢‘ç‡ï¼ˆtp_metro_gtfs æœ‰ï¼‰
- `transfers.txt` - è½¬ä¹˜ä¿¡æ¯ï¼ˆä¸¤ä¸ªæ•°æ®é›†éƒ½æ²¡æœ‰ï¼‰
- `shapes.txt` - è·¯çº¿å½¢çŠ¶ï¼ˆä¸¤ä¸ªæ•°æ®é›†éƒ½æ²¡æœ‰ï¼‰

### æ•°æ®é‡å¯¹æ¯”

| é¡¹ç›® | gtfs_tw_v5 | tp_metro_gtfs |
|------|-----------|---------------|
| Agencies | 393 | 1 |
| Routes | 9,663 | 7 |
| Stops | 154,477 | 722 |
| Trips | 326,645 | 5,990 |
| Stop Times | **0** âŒ | 100,015 âœ… |
| Frequencies | **0** | 16 |

---

## ğŸ’¡ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### ç«‹å³å¯è¡Œæ–¹æ¡ˆ

1. **ä½¿ç”¨ tp_metro_gtfs è¿›è¡Œ MATSim è½¬æ¢**:
   ```bash
   python src/main/java/org/matsim/project/tools/GtfsToMatsim.py \
     --gtfs pt2matsim/data/gtfs/tp_metro_gtfs/ \
     --network scenarios/taipei/network.xml \
     --output scenarios/taipei/
   ```

2. **éªŒè¯è½¬æ¢ç»“æœ**:
   ```bash
   # æ£€æŸ¥ç”Ÿæˆçš„ transitSchedule å’Œ transitVehicles
   ls -lh scenarios/taipei/transitSchedule.xml
   ls -lh scenarios/taipei/transitVehicles.xml
   ```

### å¦‚éœ€å…¬äº¤æ•°æ®

3. **ä» PTX å¹³å°ä¸‹è½½å®Œæ•´ GTFS**:
   ```bash
   # ç¤ºä¾‹ï¼šä¸‹è½½å°åŒ—å¸‚å…¬äº¤ GTFS
   curl -X GET "https://ptx.transportdata.tw/MOTC/v2/Bus/GTFS/City/Taipei" \
     -H "Authorization: Bearer YOUR_API_KEY" \
     -o taipei_bus_gtfs.zip
   ```

4. **åˆå¹¶ PTX å…¬äº¤æ•°æ®ä¸æ·è¿æ•°æ®**:
   - æ­¤æ—¶ä¸¤ä¸ªæ•°æ®é›†éƒ½å®Œæ•´
   - å¯ä»¥ä½¿ç”¨æœ¬æŠ¥å‘Šä¸­çš„åˆå¹¶è„šæœ¬æ¡†æ¶

---

## ğŸ“Œ ç»“è®º

**å½“å‰çŠ¶æ€**: gtfs_tw_v5 å› ç¼ºå°‘ `stop_times.txt` è€Œ**æ— æ³•ç”¨äº MATSim æ¨¡æ‹Ÿ**ã€‚

**æ¨èæ–¹æ¡ˆ**:
1. çŸ­æœŸï¼šä½¿ç”¨ `tp_metro_gtfs`ï¼ˆå°åŒ—æ·è¿ï¼‰è¿›è¡ŒåŸå‹å¼€å‘
2. ä¸­æœŸï¼šä» PTX å¹³å°è·å–å®Œæ•´çš„å…¬äº¤ GTFS æ•°æ®
3. é•¿æœŸï¼šå»ºç«‹è‡ªåŠ¨åŒ– GTFS æ›´æ–°å’Œåˆå¹¶æµç¨‹

**é£é™©æç¤º**:
- âš ï¸ ä¸è¦åœ¨ç¼ºå°‘ `stop_times.txt` çš„æ•°æ®é›†ä¸Šæµªè´¹æ—¶é—´
- âš ï¸ åˆå¹¶å‰åŠ¡å¿…éªŒè¯æ•°æ®å®Œæ•´æ€§
- âš ï¸ PTX API æœ‰æµé‡é™åˆ¶ï¼Œéœ€è¦åˆç†è§„åˆ’ä¸‹è½½ç­–ç•¥

---

**æŠ¥å‘Šç”Ÿæˆ**: Claude Code
**åˆ†æå·¥å…·**: Bash, awk, grep, wc
**æ•°æ®ä½ç½®**: `/home/user/matsim-example-project/pt2matsim/data/gtfs/`
